/*!

* sense-navigation - Sense Sheet Navigation + Actions visualization extension for Qlik Sense.
* --
* @version v0.8.4
* @link https://github.com/stefanwalther/sense-navigation
* @author Stefan Walther
* @license MIT
*/

define(["jquery","underscore","qlik","angular","core.utils/deferred","./lib/external/sense-extension-utils/extUtils","./properties","./initialproperties","text!./lib/css/main.css","text!./template.ng.html"],function($,_,qlik,angular,Deferred,extUtils,props,initProps,cssContent,ngTemplate){"use strict";extUtils.addStyleToHeader(cssContent);var faUrl=extUtils.getBasePath()+"/extensions/swr-sense-navigation/lib/external/fontawesome/css/font-awesome.min.css";function splitToStringNum(str,sep){for(var a=str.split(sep),i=0;i<a.length;i++)isNaN(a[i])||(a[i]=Number(a[i]));return a}return extUtils.addStyleLinkToHeader(faUrl,"swr-sense-navigation__fontawesome"),{definition:props,support:{export:!1,exportData:!1,snapshot:!1},initialProperties:initProps,snapshot:{canTakeSnapshot:!1},template:ngTemplate,controller:["$scope","$element",function($scope,$element){$scope.alignmentStyle="{text-align: "+$scope.align+";}",$scope.doNavigate=function(){switch($scope.layout.props.action){case"nextSheet":$scope.nextSheet();break;case"prevSheet":$scope.prevSheet();break;case"gotoSheet":$scope.gotoSheet($scope.layout.props.selectedSheet);break;case"gotoSheetById":$scope.gotoSheet($scope.layout.props.sheetId);break;case"gotoStory":$scope.gotoStory($scope.layout.props.selectedStory);break;case"openWebsite":var url=$scope.layout.props.websiteUrl,same=$scope.layout.props.sameWindow;_.isEmpty(url)||window.open(function(url){return url.startsWith("http://")||url.startsWith("https://")||url.startsWith("mailto://")?url:"http://"+url}(url),same?"_self":"")}},$scope.isEditMode=function(){return $scope.$parent.$parent.editmode},$scope.doAction=function(){if($scope.layout.props.isActionsBefore)for(var app=qlik.currApp(),fld=null,val=null,softlock=null,i=1;i<=2;i++)switch(fld=$scope.layout.props["field"+i],val=$scope.layout.props["value"+i],softlock=$scope.layout.props["softlock"+i],$scope.layout.props["actionBefore"+i]){case"clearAll":app.clearAll();break;case"lockAll":app.lockAll();break;case"unlockAll":app.unlockAll();break;case"clearField":_.isEmpty(fld)||app.field(fld).clear();break;case"selectAlternative":_.isEmpty(fld)||app.field(fld).selectAlternative(softlock);break;case"selectExcluded":_.isEmpty(fld)||app.field(fld).selectExcluded(softlock);break;case"selectField":_.isEmpty(fld)||_.isEmpty(val)||app.field(fld).selectMatch(val,!1);break;case"selectValues":if(!_.isEmpty(fld)&&!_.isEmpty(val)){var vals=splitToStringNum(val,";");app.field(fld).selectValues(vals,!1)}break;case"selectandLockField":_.isEmpty(fld)||_.isEmpty(val)||(app.field(fld).selectMatch(val,!0),app.field(fld).lock());break;case"lockField":_.isEmpty(fld)||app.field(fld).lock();break;case"applyBookmark":_.isEmpty($scope.layout.props["bookmark"+i])||app.bookmark.apply($scope.layout.props["bookmark"+i]);break;case"setVariable":_.isEmpty($scope.layout.props["variable"+i])||$scope.setVariableContent($scope.layout.props["variable"+i],val)}},$scope.go=function(){$scope.isEditMode()||($scope.doAction(),$scope.doNavigate())},$scope.nextSheet=function(){$scope.checkQlikNavigation()&&qlik.navigation.nextSheet()},$scope.prevSheet=function(){$scope.checkQlikNavigation()&&qlik.navigation.prevSheet()},$scope.gotoSheet=function(sheetId){$scope.checkQlikNavigation()&&!_.isEmpty(sheetId)&&qlik.navigation.gotoSheet(sheetId)},$scope.gotoStory=function(storyId){$scope.checkQlikNavigation()&&!_.isEmpty(storyId)&&qlik.navigation.gotoStory(storyId)},$scope.setVariableContent=function(variableName,variableValue){qlik.currApp().variable.setContent(variableName,variableValue).then(function(){angular.noop()})},$scope.checkQlikNavigation=function(){return!!qlik.navigation}}]}});